<!-- Copyright 2009-2022 Canonical Ltd.  This software is licensed under the
     GNU Affero General Public License version 3 (see the file LICENSE).
-->

<configure
    xmlns="http://namespaces.zope.org/zope"
    xmlns:browser="http://namespaces.zope.org/browser"
    xmlns:i18n="http://namespaces.zope.org/i18n"
    xmlns:webservice="http://namespaces.canonical.com/webservice"
    xmlns:xmlrpc="http://namespaces.zope.org/xmlrpc"
    xmlns:lp="http://namespaces.canonical.com/lp"
    i18n_domain="launchpad">

  <lp:authorizations module=".security" />

  <include file="vocabularies.zcml"/>
  <include package=".browser"/>

  <publisher
      name="bugs"
      factory="lp.bugs.publisher.bugs_request_publication_factory"/>
  <utility
      component="lp.bugs.publisher.BugsLayer"
      provides="zope.publisher.interfaces.browser.IDefaultBrowserLayer"
      name="bugs" />
  <utility
      component="lp.bugs.publisher.BugsFacet"
      provides="lp.services.webapp.interfaces.IFacet"
      name="bugs" />

    <lp:help-folder folder="help" name="+help-bugs" />

    <class
        class="lp.bugs.model.bugactivity.BugActivity">
        <allow
            interface="lp.bugs.interfaces.bugactivity.IBugActivity"/>
    </class>
    <lp:securedutility
        class="lp.bugs.model.bugactivity.BugActivitySet"
        provides="lp.bugs.interfaces.bugactivity.IBugActivitySet">
        <allow
            interface="lp.bugs.interfaces.bugactivity.IBugActivitySet"/>
    </lp:securedutility>

    <!-- Macros -->

        <class
            class="lp.bugs.browser.bugcomment.BugComment">
            <allow
                interface="lp.bugs.interfaces.bugmessage.IBugComment"/>
        </class>
    <subscriber
        for="lp.bugs.interfaces.cve.ICve                 zope.lifecycleevent.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.cve.cve_modified"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.bugcreation.at_least_one_task"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.karma.bug_created"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.karma.bug_modified"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <subscriber
        for="lp.bugs.interfaces.bugattachment.IBugAttachment                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.bug.notify_bug_attachment_added"/>
    <subscriber
        for="lp.bugs.interfaces.bugattachment.IBugAttachment                 lazr.lifecycle.interfaces.IObjectDeletedEvent"
        handler="lp.bugs.subscribers.bug.notify_bug_attachment_removed"/>
    <subscriber
        for="lp.bugs.interfaces.bugattachment.IBugAttachment                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <subscriber
        for="lp.bugs.interfaces.bugattachment.IBugAttachment                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug lp.bugs.interfaces.buglink.IObjectLinkedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug lp.bugs.interfaces.buglink.IObjectLinkedEvent"
        handler="lp.bugs.subscribers.karma.cve_added"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug lp.bugs.interfaces.buglink.IObjectLinkedEvent"
        handler="lp.bugs.subscribers.karma.branch_linked"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug lp.bugs.interfaces.buglink.IObjectLinkedEvent"
        handler="lp.bugs.subscribers.karma.merge_proposal_linked"/>
    <subscriber
        for="lp.bugs.interfaces.bugmessage.IBugMessage                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.bug.notify_bug_comment_added"/>
    <subscriber
        for="lp.bugs.interfaces.bugmessage.IBugMessage
             lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.webhooks.bug_comment_added"/>
    <subscriber
        for="lp.bugs.interfaces.bugmessage.IBugMessage                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.karma.bug_comment_added"/>
    <subscriber
        for="lp.bugs.interfaces.bugmessage.IBugMessage                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <subscriber
        for="lp.bugs.interfaces.bugwatch.IBugWatch                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.karma.bugwatch_added"/>
    <subscriber
        for="lp.bugs.interfaces.bugwatch.IBugWatch                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <subscriber
        for="lp.bugs.interfaces.bugwatch.IBugWatch                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.bugactivity.notify_bug_watch_modified"/>
    <subscriber
        for="lp.bugs.interfaces.bugwatch.IBugWatch                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <subscriber
        for="lp.bugs.interfaces.bugsubscription.IBugSubscription                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.bug.notify_bug_subscription_added"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.bug.notify_bug_modified"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug
             lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.webhooks.bug_created"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug
             lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.webhooks.bug_modified"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBugTask
             lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.webhooks.bugtask_created"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBugTask
             lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.webhooks.bugtask_modified"/>
    <lp:securedutility
        class="lp.systemhomes.MaloneApplication"
        provides="lp.bugs.interfaces.malone.IMaloneApplication">
        <allow
            interface="lp.bugs.interfaces.malone.IMaloneApplication"/>
    </lp:securedutility>

    <!-- pages for the malone application -->

    <xmlrpc:view
        for="lp.bugs.interfaces.malone.IMaloneApplication"
        methods="filebug"
        class="lp.bugs.xmlrpc.bug.FileBugAPI"
        permission="launchpad.AnyPerson"/>

    <!-- Global Malone portlets -->


    <!-- Preserve the /bugs/assigned link to prevent linkrot. This will now
                                 redirect into the FOAF +assignedbugs. -->


    <!-- BugTrackerPerson -->

    <class
        class="lp.bugs.model.bugtrackerperson.BugTrackerPerson">
        <allow
            interface="lp.bugs.interfaces.bugtrackerperson.IBugTrackerPerson"/>
    </class>

    <!-- CveReference -->

    <class
        class="lp.bugs.model.cvereference.CveReference">
        <allow
            interface="lp.bugs.interfaces.cvereference.ICveReference"/>
        <require
            permission="launchpad.AnyPerson"
            set_schema="lp.bugs.interfaces.cvereference.ICveReference"/>
    </class>

      <class class="lp.bugs.interfaces.bugtaskfilter.OrderedBugTask">
        <allow attributes="rank id task"/>
      </class>

        <!-- IBugTask -->

        <class
            class="lp.bugs.model.bugtask.BugTask">
            <allow
                attributes="
                    id
                    assignee_id
                    bug
                    bug_id
                    target
                    date_assigned
                    datecreated
                    date_confirmed
                    date_incomplete
                    date_inprogress
                    date_left_new
                    date_triaged
                    date_deferred
                    date_fix_committed
                    date_fix_released
                    date_left_closed
                    date_closed
                    distribution_id
                    distroseries_id
                    milestone_id
                    product_id
                    productseries_id
                    sourcepackagename_id
                    task_age
                    bug_subscribers
                    is_complete
                    canBeDeleted
                    canTransitionToStatus
                    isSubscribed
                    getPackageComponent
                    maybeConfirm
                    userHasDriverPrivileges
                    userHasBugSupervisorPrivileges
                    userCanSetAnyAssignee
                    userCanUnassign"/>
            <require
                permission="launchpad.View"
                attributes="
                    bugtargetname
                    bugtargetdisplayname
                    product
                    productseries
                    sourcepackagename
                    distribution
                    distroseries
                    milestone
                    _status
                    status
                    status_explanation
                    importance
                    importance_explanation
                    assignee
                    bugwatch
                    age
                    owner
                    targetname
                    title
                    related_tasks
                    other_affected_pillars
                    asEmailHeaderValue
                    getDelta
                    pillar
                    bugtask_branches
                    conjoined_primary
                    conjoined_replica
                    subscribe
                    getConjoinedPrimary
                    findSimilarBugs
                    getContributorInfo"/>
            <require
                permission="launchpad.Delete"
                interface="lp.bugs.interfaces.bugtask.IBugTaskDelete"/>
            <require
                permission="launchpad.Edit"
                attributes="
                    setStatusFromDebbugs
                    setImportanceFromDebbugs
                    updateTargetNameCache
                    transitionToImportance
                    transitionToStatus
                    transitionToAssignee
                    transitionToMilestone
                    transitionToTarget
                    validateTransitionToTarget
                    "/>

            <!-- XXX Brad Bollenbach 2006-09-29 bug=63000:
                 The permission checking for milestone and importance
                 is further restricted in the browser view code
                 (BugTaskEditView).
            -->
            <require
                permission="launchpad.Edit"
                set_attributes="
                    age
                    bugwatch
                    datecreated
                    importance
                    importance_explanation
                    milestone
                    owner
                    related_tasks
                    setImportanceFromDebbugs
                    setStatusFromDebbugs
                    statusdisplayhtml
                    statuselsewhere
                    status_explanation
                    targetname
                    title
                    "/>
        </class>
        <adapter
            provides="lp.services.privacy.interfaces.IObjectPrivacy"
            for="lp.bugs.interfaces.bugtask.IBugTask"
            factory="lp.bugs.browser.bugtask.BugTaskPrivacyAdapter"
            permission="zope.Public"/>
        <adapter
            for="lp.bugs.interfaces.bugtask.IBugTask"
            provides="lp.app.interfaces.launchpad.IPrivacy"
            factory="lp.bugs.adapters.bug.bugtask_to_privacy"/>
        <adapter
            for="lp.bugs.interfaces.bugtask.IBugTask"
            provides="lp.bugs.interfaces.bug.IBug"
            factory="lp.bugs.model.bugtask.BugTaskToBugAdapter"/>
        <adapter
            factory="lp.bugs.browser.bugtask.bugtarget_renderer"
            name="target"/>
        <adapter
            provides="lp.services.webapp.interfaces.IBreadcrumb"
            for="lp.bugs.interfaces.bugtask.IBugTask"
            factory="lp.bugs.browser.bugtask.BugTaskBreadcrumb"
            permission="zope.Public"/>
        <adapter
            provides="lp.services.webapp.interfaces.IBreadcrumb"
            for="lp.bugs.interfaces.bugmessage.IBugComment"
            factory="lp.bugs.browser.bugcomment.BugCommentBreadcrumb"
            permission="zope.Public"/>

        <!-- BugTaskSearchParams -->
        <class
            class="lp.bugs.interfaces.bugtasksearch.BugTaskSearchParams">
            <allow
                attributes="
                    setTarget
                    "/>
            <require
                permission="zope.Public"
                set_attributes="
                    resolved_upstream
                    "/>
        </class>

        <!-- BugTaskSet -->

        <class
            class="lp.bugs.model.bugtask.BugTaskSet">
            <allow
                interface="lp.bugs.interfaces.bugtask.IBugTaskSet"/>
        </class>
        <lp:securedutility
            provides="lp.bugs.interfaces.bugtask.IBugTaskSet"
            class="lp.bugs.model.bugtask.BugTaskSet">
            <allow
                interface="lp.bugs.interfaces.bugtask.IBugTaskSet"/>
        </lp:securedutility>

        <!-- BugTaskDelta -->

        <class
            class="lp.bugs.model.bugtask.BugTaskDelta">
            <allow
                interface="lp.bugs.interfaces.bugtask.IBugTaskDelta"/>
        </class>
    <class
        class="lp.bugs.model.bugattachment.BugAttachment">
        <require
            permission="launchpad.View"
            interface="lp.bugs.interfaces.bugattachment.IBugAttachmentView"/>
        <require
            permission="launchpad.Edit"
            interface="lp.bugs.interfaces.bugattachment.IBugAttachmentEdit"
            set_schema="lp.bugs.interfaces.bugattachment.IBugAttachmentView" />
    </class>

    <!-- BugAttachmentSet -->

    <class
        class="lp.bugs.model.bugattachment.BugAttachmentSet">
        <allow
            interface="lp.bugs.interfaces.bugattachment.IBugAttachmentSet"/>
    </class>
    <lp:securedutility
        class="lp.bugs.model.bugattachment.BugAttachmentSet"
        provides="lp.bugs.interfaces.bugattachment.IBugAttachmentSet">
        <allow
            interface="lp.bugs.interfaces.bugattachment.IBugAttachmentSet"/>
    </lp:securedutility>

        <!-- BugTracker -->

        <class
            class="lp.bugs.model.bugtracker.BugTracker">
            <implements
                interface="lp.bugs.interfaces.bugtracker.IBugTracker"/>
            <require
                permission="zope.Public"
                attributes="
                    active
                    aliases
                    baseurl
                    bugtrackertype
                    componentForDistroSourcePackage
                    contactdetails
                    getAllRemoteComponentGroups
                    getBugFilingAndSearchLinks
                    getBugsWatching
                    getLinkedPersonByName
                    getRemoteComponentForDistroSourcePackageName
                    getRemoteComponentGroup
                    has_lp_plugin
                    id
                    imported_bug_messages
                    latestwatches
                    multi_product
                    name
                    owner
                    products
                    summary
                    title
                    watches
                    watches_needing_update
                    watches_ready_to_check
                    watches_with_unpushed_comments
                    getRelatedPillars
                    "/>
            <require
                permission="launchpad.Edit"
                attributes="
                    addRemoteComponentGroup
                    destroySelf
                    ensurePersonForSelf
                    linkPersonToSelf
                    "
                set_attributes="
                    aliases
                    baseurl
                    bugtrackertype
                    contactdetails
                    has_lp_plugin
                    name
                    owner
                    summary
                    title
                    "/>
            <require
                permission="launchpad.Admin"
                attributes="resetWatches"
                set_attributes="active"/>
        </class>
        <adapter
            provides="lp.services.webapp.interfaces.IBreadcrumb"
            for="lp.bugs.interfaces.bugtracker.IBugTracker"
            factory="lp.services.webapp.breadcrumb.TitleBreadcrumb"
            permission="zope.Public"/>

        <!-- BugTrackerSet -->

        <class
            class="lp.bugs.model.bugtracker.BugTrackerSet">
            <allow
                interface="lp.bugs.interfaces.bugtracker.IBugTrackerSet"
                attributes="__len__"/>
        </class>
        <lp:securedutility
            class="lp.bugs.model.bugtracker.BugTrackerSet"
            provides="lp.bugs.interfaces.bugtracker.IBugTrackerSet">
            <allow
                interface="lp.bugs.interfaces.bugtracker.IBugTrackerSet"
                attributes="__len__"/>
        </lp:securedutility>
        <adapter
            provides="lp.services.webapp.interfaces.IBreadcrumb"
            for="lp.bugs.interfaces.bugtracker.IBugTrackerSet"
            factory="lp.bugs.browser.bugtracker.BugTrackerSetBreadcrumb"
            permission="zope.Public"/>

        <!-- BugTrackerAlias -->

        <class
            class="lp.bugs.model.bugtracker.BugTrackerAlias">
            <allow
                interface="lp.bugs.interfaces.bugtracker.IBugTrackerAlias"/>
            <require
                permission="zope.Public"
                set_schema="lp.bugs.interfaces.bugtracker.IBugTrackerAlias"/>
        </class>

        <!-- BugTrackerAliasSet -->

        <class
            class="lp.bugs.model.bugtracker.BugTrackerAliasSet">
            <allow
                interface="lp.bugs.interfaces.bugtracker.IBugTrackerAliasSet"/>
        </class>
        <lp:securedutility
            class="lp.bugs.model.bugtracker.BugTrackerAliasSet"
            provides="lp.bugs.interfaces.bugtracker.IBugTrackerAliasSet">
            <allow
                interface="lp.bugs.interfaces.bugtracker.IBugTrackerAliasSet"/>
        </lp:securedutility>

        <!--BugTrackerComponent -->

        <class
            class="lp.bugs.model.bugtracker.BugTrackerComponent">
            <require
                permission="zope.Public"
                attributes="
                    id
                    name
                    is_visible
                    is_custom
                    distro_source_package
                    component_group
                    "/>
            <require
                permission="launchpad.AnyPerson"
                set_attributes="
                    is_visible
                    is_custom
                    distro_source_package
                    "/>
            <implements
                interface="lp.bugs.interfaces.bugtracker.IBugTrackerComponent"/>
        </class>

        <!--BugTrackerComponentGroup -->

        <class
            class="lp.bugs.model.bugtracker.BugTrackerComponentGroup">
            <require
                permission="zope.Public"
                attributes="
                    id
                    name
                    bug_tracker
                    components
                    getComponent
                    addComponent
                    addCustomComponent
                    "/>
            <implements
                interface="lp.bugs.interfaces.bugtracker.IBugTrackerComponentGroup"/>
        </class>

        <!-- RemoteBug -->

        <class
            class="lp.bugs.browser.bugtracker.RemoteBug">
            <allow
                interface="lp.bugs.interfaces.bugtracker.IRemoteBug"/>
        </class>

        <!-- GitHubRateLimit -->

        <class
            class="lp.bugs.externalbugtracker.github.GitHubRateLimit">
            <allow
                interface="lp.bugs.externalbugtracker.github.IGitHubRateLimit"/>
        </class>
        <utility
            factory="lp.bugs.externalbugtracker.github.GitHubRateLimit"
            provides="lp.bugs.externalbugtracker.github.IGitHubRateLimit"/>

    <!-- IBugBranch -->

    <class
        class="lp.bugs.model.bugbranch.BugBranch">
        <allow
            interface="lp.bugs.interfaces.bugbranch.IBugBranch"/>
    </class>

    <!-- BugBranchSet -->

    <class
        class="lp.bugs.model.bugbranch.BugBranchSet">
        <allow
            interface="lp.bugs.interfaces.bugbranch.IBugBranchSet"/>
    </class>
    <lp:securedutility
        class="lp.bugs.model.bugbranch.BugBranchSet"
        provides="lp.bugs.interfaces.bugbranch.IBugBranchSet">
        <allow
            interface="lp.bugs.interfaces.bugbranch.IBugBranchSet"/>
    </lp:securedutility>

        <!-- CVE -->

        <class
            class="lp.bugs.model.cve.Cve">
            <allow
                interface="lp.bugs.interfaces.cve.ICve"/>
            <require
                permission="launchpad.AnyPerson"
                set_schema="lp.bugs.interfaces.cve.ICve"/>

            <!-- IBugLinkTarget -->

            <allow
                attributes="
                    bug_links"/>
            <require
                permission="launchpad.AnyPerson"
                attributes="
                    linkBug
                    unlinkBug"/>
        </class>

        <!-- CveSet -->

        <class
            class="lp.bugs.model.cve.CveSet">
            <allow
                interface="lp.bugs.interfaces.cve.ICveSet"/>
        </class>
        <lp:securedutility
            class="lp.bugs.model.cve.CveSet"
            provides="lp.bugs.interfaces.cve.ICveSet">
            <allow
                interface="lp.bugs.interfaces.cve.ICveSet"/>
        </lp:securedutility>

    <!-- Vulnerability -->
    <class class="lp.bugs.model.vulnerability.Vulnerability">
      <require
        permission="launchpad.View"
        interface="lp.bugs.interfaces.vulnerability.IVulnerabilityView
                   lp.bugs.interfaces.vulnerability.IVulnerabilityEditableAttributes" />
      <require
        permission="launchpad.Edit"
        interface="lp.bugs.interfaces.vulnerability.IVulnerabilityEdit"
        set_schema="lp.bugs.interfaces.vulnerability.IVulnerabilityEditableAttributes" />

      <!-- IBugLinkTarget -->
      <allow
          attributes="
              bugs"/>
      <require
          permission="launchpad.Edit"
          attributes="
              linkBug
              unlinkBug"/>
    </class>
    <adapter
        provides="lp.services.webapp.interfaces.IBreadcrumb"
        for="lp.bugs.interfaces.vulnerability.IVulnerability"
        factory="lp.bugs.browser.vulnerability.VulnerabilityBreadcrumb"
        permission="zope.Public"/>

    <class class="lp.bugs.model.vulnerability.VulnerabilitySet">
      <allow interface="lp.bugs.interfaces.vulnerability.IVulnerabilitySet" />
    </class>
    <lp:securedutility
      class="lp.bugs.model.vulnerability.VulnerabilitySet"
      provides="lp.bugs.interfaces.vulnerability.IVulnerabilitySet">
      <allow interface="lp.bugs.interfaces.vulnerability.IVulnerabilitySet" />
    </lp:securedutility>

    <!-- VulnerabilityActivity -->
    <class class="lp.bugs.model.vulnerability.VulnerabilityActivity">
      <require
        permission="launchpad.View"
        interface="lp.bugs.interfaces.vulnerability.IVulnerabilityActivity" />
    </class>
    <class class="lp.bugs.model.vulnerability.VulnerabilityActivitySet">
      <allow interface="lp.bugs.interfaces.vulnerability.IVulnerabilityActivitySet" />
    </class>
    <lp:securedutility
      class="lp.bugs.model.vulnerability.VulnerabilityActivitySet"
      provides="lp.bugs.interfaces.vulnerability.IVulnerabilityActivitySet">
      <allow interface="lp.bugs.interfaces.vulnerability.IVulnerabilityActivitySet" />
    </lp:securedutility>

    <!-- BugSubscription -->

    <class
        class="lp.bugs.model.bugsubscription.BugSubscription">
        <allow
            interface="lp.bugs.interfaces.bugsubscription.IBugSubscription"/>
        <require
            permission="launchpad.Edit"
            set_attributes="bug_notification_level" />
    </class>

    <!-- BugSubscriptionFilter -->
    <class
        class=".model.bugsubscriptionfilter.BugSubscriptionFilter">
      <allow
          interface=".interfaces.bugsubscriptionfilter.IBugSubscriptionFilterAttributes"/>
      <allow
          interface=".interfaces.bugsubscriptionfilter.IBugSubscriptionFilterMethodsPublic"/>
      <require
          permission="launchpad.Edit"
          interface=".interfaces.bugsubscriptionfilter.IBugSubscriptionFilterMethodsProtected"
          set_schema=".interfaces.bugsubscriptionfilter.IBugSubscriptionFilterAttributes" />
    </class>
    <adapter
        for=".interfaces.bugsubscriptionfilter.IBugSubscriptionFilter"
        provides="lp.registry.interfaces.distribution.IDistribution"
        factory=".adapters.bugsubscriptionfilter.bugsubscriptionfilter_to_distribution"/>
    <adapter
        for=".interfaces.bugsubscriptionfilter.IBugSubscriptionFilter"
        provides="lp.registry.interfaces.product.IProduct"
        factory=".adapters.bugsubscriptionfilter.bugsubscriptionfilter_to_product"/>

    <!-- BugMute -->
    <class
        class=".model.bug.BugMute">
      <allow
          interface=".interfaces.bug.IBugMute"/>
    </class>

    <!-- BugSubscriptionFilterMute -->
    <class
        class=".model.bugsubscriptionfilter.BugSubscriptionFilterMute">
      <allow
          interface=".interfaces.bugsubscriptionfilter.IBugSubscriptionFilterMute"/>
      <require
          permission="launchpad.Edit"
          set_schema=".interfaces.bugsubscriptionfilter.IBugSubscriptionFilterMute" />
    </class>


    <!-- BugSubscriptionInfo -->

    <class class=".model.bug.BugSubscriptionInfo">
      <!-- Instance variables -->
      <require
          permission="launchpad.View"
          attributes="
              bug
              bugtask
              level
              " />
      <!-- Properties -->
      <require
          permission="launchpad.View"
          attributes="
              all_assignees
              also_notified_subscribers
              direct_subscribers
              direct_subscribers_at_all_levels
              direct_subscriptions
              direct_subscriptions_at_all_levels
              duplicate_only_subscriptions
              duplicate_subscriptions
              indirect_subscribers
              muted_subscribers
              structural_subscribers
              structural_subscriptions
              " />
      <!-- Methods -->
      <require
          permission="launchpad.View"
          attributes="
              forLevel
              forTask
              " />
    </class>

    <!-- PersonSubscriptionInfo -->

    <class class="lp.bugs.model.personsubscriptioninfo.RealSubscriptionInfo">
        <allow
            interface="
              lp.bugs.interfaces.personsubscriptioninfo.IRealSubscriptionInfo"/>
    </class>

    <class class="lp.bugs.model.personsubscriptioninfo.VirtualSubscriptionInfo">
        <allow
            interface="
              lp.bugs.interfaces.personsubscriptioninfo.IVirtualSubscriptionInfo"/>
    </class>

    <class class="lp.bugs.model.personsubscriptioninfo.RealSubscriptionInfoCollection">
        <allow
            interface="
              lp.bugs.interfaces.personsubscriptioninfo.IRealSubscriptionInfoCollection"/>
    </class>

    <class class="lp.bugs.model.personsubscriptioninfo.VirtualSubscriptionInfoCollection">
        <allow
            interface="
              lp.bugs.interfaces.personsubscriptioninfo.IVirtualSubscriptionInfoCollection"/>
    </class>

    <class class="lp.bugs.model.personsubscriptioninfo.PersonSubscriptions">
        <allow
            interface="
              lp.bugs.interfaces.personsubscriptioninfo.IPersonSubscriptions"/>
    </class>

        <!-- Bug -->

        <class
            class="lp.bugs.model.bug.Bug">
            <allow
                interface="lp.bugs.interfaces.bug.IBugPublic"/>
            <require
                permission="launchpad.View"
                interface="lp.bugs.interfaces.bug.IBugView"
                attributes="
                    linked_branches
                    linked_bugbranches
                    getVisibleLinkedBranches
                    linked_merge_proposals
                    getVisibleLinkedMergeProposals"/>
            <require
                permission="launchpad.Append"
                interface="lp.bugs.interfaces.bug.IBugAppend"
                attributes="
                    presences
                    linkBranch
                    unlinkBranch"/>
            <require
                permission="launchpad.Edit"
                interface="lp.bugs.interfaces.bug.IBugEdit"
                set_attributes="
                    name
                    tags
                    title
                    description"/>
            <require
                permission="launchpad.Moderate"
                interface="lp.bugs.interfaces.bug.IBugModerate"
                set_attributes="lock_reason"/>
        </class>
        <adapter
            for="lp.bugs.interfaces.bug.IBug"
            provides="lp.services.webapp.interfaces.ILaunchpadContainer"
            factory="lp.bugs.publisher.LaunchpadBugContainer"/>

        <!-- BugSet -->

        <class
            class="lp.bugs.model.bug.BugSet">
            <allow
                interface="lp.bugs.interfaces.bug.IBugSet"/>
        </class>
        <lp:securedutility
            class="lp.bugs.model.bug.BugSet"
            provides="lp.bugs.interfaces.bug.IBugSet">
            <allow
                interface="lp.bugs.interfaces.bug.IBugSet"/>
        </lp:securedutility>

        <!-- BugDelta -->

        <class
            class="lp.bugs.adapters.bugdelta.BugDelta">
            <allow
                interface="lp.bugs.interfaces.bug.IBugDelta"/>
        </class>

    <!-- BugMessage -->

    <class
        class="lp.bugs.model.bugmessage.BugMessage">
        <allow
            interface="lp.bugs.interfaces.bugmessage.IBugMessageView"/>
        <require permission="launchpad.Edit"
            interface="lp.services.messages.interfaces.message.IMessageEdit" />
        <require
            permission="launchpad.InternalScriptsOnly"
            set_attributes="remote_comment_id bugwatch index"/>
    </class>

    <!-- BugMessageSet -->

    <class
        class="lp.bugs.model.bugmessage.BugMessageSet">
        <allow
            interface="lp.bugs.interfaces.bugmessage.IBugMessageSet"/>
    </class>
    <lp:securedutility
        class="lp.bugs.model.bugmessage.BugMessageSet"
        provides="lp.bugs.interfaces.bugmessage.IBugMessageSet">
        <allow
            interface="lp.bugs.interfaces.bugmessage.IBugMessageSet"/>
    </lp:securedutility>
        <class
            class="lp.bugs.model.bugnomination.BugNomination">
            <require
                permission="launchpad.View"
                attributes="
                    id
                    date_created
                    date_decided
                    distroseries
                    productseries
                    bug
                    owner
                    owner_id
                    decider
                    target
                    status
                    isApproved
                    isDeclined
                    isProposed
                    canApprove"/>
            <require
                permission="launchpad.Driver"
                attributes="
                    approve
                    decline"/>
            <require
                permission="launchpad.Edit"
                attributes="
                    destroySelf"/>
        </class>
        <lp:securedutility
            class="lp.bugs.model.bugnomination.BugNominationSet"
            provides="lp.bugs.interfaces.bugnomination.IBugNominationSet">
            <allow
                interface="lp.bugs.interfaces.bugnomination.IBugNominationSet"/>
        </lp:securedutility>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug                            zope.lifecycleevent.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.bugactivity.record_bug_added"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug lp.bugs.interfaces.buglink.IObjectLinkedEvent"
        handler="lp.bugs.subscribers.bugactivity.record_cve_linked_to_bug"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug lp.bugs.interfaces.buglink.IObjectUnlinkedEvent"
        handler="lp.bugs.subscribers.bugactivity.record_cve_unlinked_from_bug"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug lp.bugs.interfaces.buglink.IObjectLinkedEvent"
        handler="lp.bugs.subscribers.bugactivity.record_merge_proposal_linked_to_bug"/>
    <subscriber
        for="lp.bugs.interfaces.bug.IBug lp.bugs.interfaces.buglink.IObjectUnlinkedEvent"
        handler="lp.bugs.subscribers.bugactivity.record_merge_proposal_unlinked_from_bug"/>
    <subscriber
        for="lp.bugs.interfaces.bugsubscription.IBugSubscription                     zope.lifecycleevent.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.bugactivity.record_bugsubscription_added"/>
    <subscriber
        for="lp.bugs.interfaces.bugsubscription.IBugSubscription                     lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.bugactivity.record_bugsubscription_edited"/>

        <!-- BugPresence -->

        <class
            class="lp.bugs.model.bugpresence.BugPresence">
            <implements
                interface="lp.bugs.interfaces.bugpresence.IBugPresence"/>
            <require
                permission="launchpad.View"
                set_schema="lp.bugs.interfaces.bugpresence.IBugPresence"
                attributes="
                    id
                    bug
                    product
                    distribution
                    source_package_name
                    git_repository
                    break_fix_data"/>
            <require
                permission="launchpad.Edit"
                attributes="destroySelf"/>
        </class>

        <!-- BugPresenceSet -->

        <class
            class="lp.bugs.model.bugpresence.BugPresenceSet">
            <allow
                interface="lp.bugs.interfaces.bugpresence.IBugPresenceSet"/>
        </class>
        <lp:securedutility
            class="lp.bugs.model.bugpresence.BugPresenceSet"
            provides="lp.bugs.interfaces.bugpresence.IBugPresenceSet">
            <allow
                interface="lp.bugs.interfaces.bugpresence.IBugPresenceSet"/>
        </lp:securedutility>

        <!-- BugWatch -->

        <class
            class="lp.bugs.model.bugwatch.BugWatch">
            <implements
                interface="lp.bugs.interfaces.bugwatch.IBugWatch"/>
            <require
                permission="zope.Public"
                attributes="
                    activity
                    bug
                    bugtasks
                    bugtracker
                    can_be_rescheduled
                    datecreated
                    failed_activity
                    hasComment
                    unpushed_comments
                    id
                    last_error_type
                    lastchanged
                    lastchecked
                    needscheck
                    next_check
                    owner
                    remote_importance
                    remotebug
                    remotestatus
                    title
                    url
                    getBugMessages
                    getImportedBugMessages"/>
            <require
                permission="launchpad.AnyPerson"
                attributes="
                    destroySelf
                    addActivity
                    setNextCheck"
                set_attributes="bugtracker remotebug"/>
            <require
                permission="launchpad.Admin"
                attributes="reset" />
            <require
                permission="launchpad.InternalScriptsOnly"
                attributes="
                    addComment
                    updateImportance
                    updateStatus
                    "
                set_attributes="
                    last_error_type
                    lastchanged
                    lastchecked
                    needscheck
                    next_check
                    remote_importance
                    remotestatus
                    "/>
        </class>

        <!-- https://launchpad.net/bugs/98639 -->


        <!--BugWatchSet -->

        <class
            class="lp.bugs.model.bugwatch.BugWatchSet">
            <allow
                interface="lp.bugs.interfaces.bugwatch.IBugWatchSet"/>
        </class>
        <lp:securedutility
            class="lp.bugs.model.bugwatch.BugWatchSet"
            provides="lp.bugs.interfaces.bugwatch.IBugWatchSet">
            <allow
                interface="lp.bugs.interfaces.bugwatch.IBugWatchSet"/>
        </lp:securedutility>

        <!-- BugWatchActivity -->
        <class
            class="lp.bugs.model.bugwatch.BugWatchActivity">
            <allow
                interface="lp.bugs.interfaces.bugwatch.IBugWatchActivity"/>
        </class>
    <subscriber
        for="lp.bugs.interfaces.bugtask.IBugTask                 lazr.lifecycle.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.bugactivity.notify_bugtask_added"/>
    <subscriber
        for="lp.bugs.interfaces.bugtask.IBugTask                 lazr.lifecycle.interfaces.IObjectDeletedEvent"
        handler="lp.bugs.subscribers.bugactivity.notify_bugtask_deleted"/>
    <subscriber
        for="lp.bugs.interfaces.bugtask.IBugTask                 zope.lifecycleevent.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.karma.bugtask_created"/>
    <subscriber
        for="lp.bugs.interfaces.bugtask.IBugTask                 zope.lifecycleevent.interfaces.IObjectCreatedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <subscriber
        for="lp.bugs.interfaces.bugtask.IBugTask                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.bugtask.notify_bugtask_edited"/>
    <subscriber
        for="lp.bugs.interfaces.bugtask.IBugTask                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.karma.bugtask_modified"/>
    <subscriber
        for="lp.bugs.interfaces.bugtask.IBugTask                 lazr.lifecycle.interfaces.IObjectModifiedEvent"
        handler="lp.bugs.subscribers.buglastupdated.update_bug_date_last_updated"/>
    <class
        class="lp.bugs.model.bugnotification.BugNotification">
        <allow
            interface="lp.bugs.interfaces.bugnotification.IBugNotification"/>
        <require
            permission="launchpad.AnyPerson"
            set_schema="lp.bugs.interfaces.bugnotification.IBugNotification"/>
	<require
	    permission="launchpad.Edit"
            attributes="destroySelf" />
    </class>
    <class
        class="lp.bugs.model.bugnotification.BugNotificationRecipient">
        <allow
            interface="lp.bugs.interfaces.bugnotification.IBugNotificationRecipient"/>
    </class>
    <class
        class="lp.bugs.mail.bugnotificationrecipients.BugNotificationRecipients">
        <allow
            interface="lp.services.mail.interfaces.INotificationRecipientSet"/>
        <!-- BugNotificationRecipients provides the following
             attributes/methods in addition. -->
        <allow
            attributes="subscription_filters addFilter"/>
    </class>
    <lp:securedutility
        provides="lp.bugs.interfaces.bugnotification.IBugNotificationSet"
        class="lp.bugs.model.bugnotification.BugNotificationSet">
        <allow
            interface="lp.bugs.interfaces.bugnotification.IBugNotificationSet"/>
    </lp:securedutility>

    <!-- ProcessApportBlobJobs -->
    <class class="lp.bugs.model.apportjob.ProcessApportBlobJob">
        <allow interface="lp.bugs.interfaces.apportjob.IApportJob" />
        <allow interface="lp.bugs.interfaces.apportjob.IProcessApportBlobJob"/>
    </class>
    <lp:securedutility
        component="lp.bugs.model.apportjob.ProcessApportBlobJob"
        provides="lp.bugs.interfaces.apportjob.IProcessApportBlobJobSource">
        <allow
            interface="lp.bugs.interfaces.apportjob.IProcessApportBlobJobSource"/>
    </lp:securedutility>

    <!-- FileBugData -->
    <class class="lp.bugs.model.bug.FileBugData">
        <allow interface="lp.bugs.interfaces.bug.IFileBugData" />
    </class>

    <!-- StructuralSubscription -->

    <class
        class="lp.bugs.model.structuralsubscription.StructuralSubscription">
        <allow
            interface=".interfaces.structuralsubscription.IStructuralSubscriptionPublic" />
        <require
            set_schema=".interfaces.structuralsubscription.IStructuralSubscriptionPublic"
            permission="zope.Public" />
        <require
            interface=".interfaces.structuralsubscription.IStructuralSubscriptionRestricted"
            permission="launchpad.Edit" />
    </class>
    <adapter
        factory=".model.structuralsubscription.DistroSeriesTargetHelper"
        permission="zope.Public"/>
    <adapter
        factory=".model.structuralsubscription.OCIProjectTargetHelper"
        permission="zope.Public"/>
    <adapter
        factory=".model.structuralsubscription.ProjectGroupTargetHelper"
        permission="zope.Public"/>
    <adapter
        factory=".model.structuralsubscription.DistributionSourcePackageTargetHelper"
        permission="zope.Public"/>
    <adapter
        factory=".model.structuralsubscription.MilestoneTargetHelper"
        permission="zope.Public"/>
    <adapter
        factory=".model.structuralsubscription.ProductTargetHelper"
        permission="zope.Public"/>
    <adapter
        factory=".model.structuralsubscription.ProductSeriesTargetHelper"
        permission="zope.Public"/>
    <adapter
        factory=".model.structuralsubscription.DistributionTargetHelper"
        permission="zope.Public"/>

  <webservice:register module="lp.bugs.errors" />
  <webservice:register module="lp.bugs.interfaces.webservice" />

  <lp:securedutility
    name="UsesBugsDistribution"
    component="lp.bugs.vocabularies.UsesBugsDistributionVocabulary"
    provides="zope.schema.interfaces.IVocabularyFactory"
    >
    <allow interface="zope.schema.interfaces.IVocabularyFactory"/>
  </lp:securedutility>
</configure>
