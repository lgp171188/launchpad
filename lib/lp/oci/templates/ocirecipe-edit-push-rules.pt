<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="launchpad">
<body>

<metal:block fill-slot="head_epilogue">
  <style type="text/css">
    .subordinate {
      margin: 0.5em 0 0.5em 4em;
    }
  </style>
</metal:block>

<div metal:fill-slot="main">
    <div metal:use-macro="context/@@launchpad_form/form">
    <metal:formbody fill-slot="widgets">
      <p condition="view/can_edit_credentials">
        <a class="sprite edit" tal:attributes="href context/owner/fmt:url/+edit-oci-registry-credentials">Edit OCI registry credentials</a>
      </p>
      <table class="form">
        <tr tal:repeat="rule context/push_rules"
            tal:attributes="id string:rule-${rule/id}">
          <tal:rules_widgets
            define="rules_widgets python:view.getRulesWidgets(rule);
                    parity python:'even' if repeat['rule'].even() else 'odd'">
            <td tal:define="widget nocall:rules_widgets/image_name">
              <metal:widget use-macro="context/@@launchpad_form/widget_div" />
            </td>
            <td tal:define="widget nocall:rules_widgets/username">
              <metal:widget use-macro="context/@@launchpad_form/widget_div" />
            </td>
            <td tal:define="widget nocall:rules_widgets/url">
              <metal:widget use-macro="context/@@launchpad_form/widget_div" />
            </td>
            <td tal:define="widget nocall:rules_widgets/delete">
              <metal:widget use-macro="context/@@launchpad_form/widget_div" />
            </td>
          </tal:rules_widgets>
        </tr>
        <tr>
          <td>
            <h2>Add new push rule</h2>
          </td>
        </tr>
        <tr>
          <td tal:define="widget nocall:view/widgets/add_image_name">
            <metal:widget use-macro="context/@@launchpad_form/widget_div" />
          </td>
        </tr>
        <tr>
          <td>
            <tal:widget define="widget nocall:view/widgets/use_existing_credentials">
              <metal:block use-macro="context/@@launchpad_form/widget_div" />
            </tal:widget>
          </td>
        </tr>
        <tr>
          <td>
            <table class="subordinate">
              <tal:widget define="widget nocall:view/widgets/existing_credentials">
                <metal:row use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
            </table>
          </td>
        </tr>
        <tr>
          <td>
            <tal:widget define="widget nocall:view/widgets/add_new_credentials">
              <metal:block use-macro="context/@@launchpad_form/widget_row" />
            </tal:widget>
          </td>
        </tr>
        <tr>
          <td>
            <table class="subordinate">
              <tal:widget define="widget nocall:view/widgets/add_url">
                <metal:row use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
              <tal:widget define="widget nocall:view/widgets/add_username">
                <metal:row use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
              <tal:widget define="widget nocall:view/widgets/add_password">
                <metal:row use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
              <tal:widget define="widget nocall:view/widgets/add_confirm_password">
                <metal:row use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
            </table>
          </td>
        </tr>
      </table>
    </metal:formbody>
</div>

  <script type="text/javascript">
    LPJS.use('lp.oci.ocirecipe.edit', function(Y) {
      Y.on('domready', function(e) {
        Y.lp.oci.ocirecipe.edit.setup();
      }, window);
    });
  </script>

</div>
</body>
</html>
